{% block ssooverride %}
    <script>
    /**
     * This code ensures the "publish" button is only
     * visible when the user is logged in according
     * the persona SSO that we employ for webmaker.org
     */
    define( "ssooverride", [
      "jquery",
      "thimblePage"
    ], function($, ThimblePage) {
      var publishButton = $('.publish-button'),
          myProjects = $( ".my-projects-iframe" ),
          loggedIn = false,
          projectURL = "{{audience}}/me?app={{appname}}";

      publishButton.hide();

      navigator.idSSO.app = {
        onlogin: function(loggedInUser, displayName) {
          publishButton.show();
          var newMyProjects = $("<iframe class='my-projects-iframe' src='" + projectURL + "'></iframe>");
          myProjects.replaceWith(newMyProjects);
          myProjects = newMyProjects;
        },
        onlogout: function() {
          publishButton.hide();
          myProjects.attr("src", "");
        }
      };
    });
    </script>
{% endblock %}
